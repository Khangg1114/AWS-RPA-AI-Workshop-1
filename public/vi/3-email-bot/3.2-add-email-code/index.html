<!DOCTYPE html>
<html lang="vi" class="js csstransforms3d">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.148.1">
    <meta name="description" content="">
<meta name="author" content="journeyoftheaverageguy@gmail.com">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Thêm Email Automation Code :: Nền tảng RPA đơn giản với AI trên AWS</title>

    
    <link href="/css/nucleus.css?1754284887" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1754284887" rel="stylesheet">
    <link href="/css/hybrid.css?1754284887" rel="stylesheet">
    <link href="/css/featherlight.min.css?1754284887" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1754284887" rel="stylesheet">
    <link href="/css/auto-complete.css?1754284887" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1754284887" rel="stylesheet">
    <link href="/css/theme.css?1754284887" rel="stylesheet">
    <link href="/css/hugo-theme.css?1754284887" rel="stylesheet">
    
    <link href="/css/theme-workshop.css?1754284887" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1754284887"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    

  </head>
  <body class="" data-url="/vi/3-email-bot/3.2-add-email-code/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1754284887"></script>
<script type="text/javascript" src="/js/auto-complete.js?1754284887"></script>
<script type="text/javascript">
    
        var baseurl = "\/\/localhost:1313\/\/vi";
    
</script>
<script type="text/javascript" src="/js/search.js?1754284887"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/vi/1-setup/" title="Thiết lập Môi trường AWS" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-setup/">
           <b> 1. </b> Thiết lập Môi trường AWS
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/1-setup/1.1-create-s3-bucket/" title="Tạo S3 Bucket" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-setup/1.1-create-s3-bucket/">
           <b> 1.1 </b> Tạo S3 Bucket
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/1-setup/1.2-create-dynamodb/" title="Tạo DynamoDB Table" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-setup/1.2-create-dynamodb/">
           <b> 1.2 </b> Tạo DynamoDB Table
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/1-setup/1.3-setup-ses/" title="Thiết lập Amazon SES" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-setup/1.3-setup-ses/">
           <b> 1.3 </b> Thiết lập Amazon SES
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/1-setup/1.4-create-iam-role/" title="Tạo IAM Role" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-setup/1.4-create-iam-role/">
           <b> 1.4 </b> Tạo IAM Role
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/2-document-bot/" title="Tạo Document Processing Bot" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-document-bot/">
           <b> 2. </b> Tạo Document Processing Bot
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/2-document-bot/2.1-create-lambda/" title="Tạo Lambda Function" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-document-bot/2.1-create-lambda/">
           <b> 2.1 </b> Tạo Lambda Function
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-document-bot/2.2-add-code/" title="Thêm Code Xử lý" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-document-bot/2.2-add-code/">
           <b> 2.2 </b> Thêm Code Xử lý
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-document-bot/2.3-configure-trigger/" title="Cấu hình S3 Trigger" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-document-bot/2.3-configure-trigger/">
           <b> 2.3 </b> Cấu hình S3 Trigger
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-document-bot/2.4-test-function/" title="Test Document Processing" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-document-bot/2.4-test-function/">
           <b> 2.4 </b> Test Document Processing
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/3-email-bot/" title="Xây dựng Email Automation Bot" class="dd-item 
        parent
        
        
        ">
      <a href="/vi/3-email-bot/">
           <b> 3. </b> Xây dựng Email Automation Bot
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/3-email-bot/3.1-create-email-lambda/" title="Tạo Email Lambda Function" class="dd-item 
        
        
        
        ">
      <a href="/vi/3-email-bot/3.1-create-email-lambda/">
           <b> 3.1 </b> Tạo Email Lambda Function
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-email-bot/3.2-add-email-code/" title="Thêm Email Automation Code" class="dd-item 
        
        active
        
        ">
      <a href="/vi/3-email-bot/3.2-add-email-code/">
           <b> 3.2 </b> Thêm Email Automation Code
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-email-bot/3.3-configure-schedule/" title="Cấu hình Lịch Email" class="dd-item 
        
        
        
        ">
      <a href="/vi/3-email-bot/3.3-configure-schedule/">
           <b> 3.3 </b> Cấu hình Lịch Email
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-email-bot/3.4-test-email/" title="Test Hệ thống Email" class="dd-item 
        
        
        
        ">
      <a href="/vi/3-email-bot/3.4-test-email/">
           <b> 3.4 </b> Test Hệ thống Email
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/4-cleanup/" title="Dọn dẹp Tài nguyên" class="dd-item 
        
        
        
        ">
      <a href="/vi/4-cleanup/">
           <b> 4. </b> Dọn dẹp Tài nguyên
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="http://awsstudygroup.com"><i class='fab fa-aws'></i> AWS Study Group - Blog</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj"><i class='fab fa-facebook'></i> AWS Study Group - Nhóm FB</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="//localhost:1313/3-email-bot/3.2-add-email-code/">English</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="vi" value="//localhost:1313/vi/3-email-bot/3.2-add-email-code/" selected>Tiếng Việt</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
     <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830891&style=0038&nbdigits=9&type=page&initCount=0" title="Migrate" Alt="web counter"   border="0" /></a>  <br>
     <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" Alt="web counter"   border="0"   />
     
</left>
<left>
    <br>
    <br>
        <b> Last Updated </b> <br>
        <i><font color=orange>03-08-2025</font></i>
    </left>
    <left>
        <br>
        <br>
            <b> Team </b> <br>
           
            <i>
                <a href="https://www.linkedin.com/in/jotaguy"  style="color:orange">Gia Hưng</a>
        </i>
        </left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/vi/'>Nền tảng RPA đơn giản với AI trên AWS</a> > <a href='/vi/3-email-bot/'>Xây dựng Email Automation Bot</a> > Thêm Email Automation Code
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        

        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Thêm Email Automation Code
            </h1>
          

        



	<h4 id="tổng-quan">Tổng quan</h4>
<p>Thêm Python code vào email Lambda function sẽ query tài liệu đã xử lý và gửi báo cáo email HTML đẹp.</p>
<h4 id="hướng-dẫn-từng-bước">Hướng dẫn Từng bước</h4>
<h4 id="bước-1-mở-email-function-code-editor">Bước 1: Mở Email Function Code Editor</h4>
<ol>
<li>Trong Lambda function <code>email-automation-bot</code> của bạn
<img src="/images/3/Add-Email-Automation-Code-1.png" alt="Add-Email-Automation-Code-1"></li>
<li>Đảm bảo bạn đang ở tab <strong>Code</strong></li>
<li>Bạn sẽ thấy template code Lambda mặc định</li>
</ol>
<h4 id="bước-2-xóa-code-mặc-định">Bước 2: Xóa Code Mặc định</h4>
<ol>
<li>Chọn tất cả code mặc định trong editor</li>
<li>Xóa hoàn toàn</li>
<li>Editor sẽ trống
<img src="/images/3/Add-Email-Automation-Code-2.png" alt="Add-Email-Automation-Code-2"></li>
</ol>
<h4 id="bước-3-thêm-email-automation-code">Bước 3: Thêm Email Automation Code</h4>
<p>Copy và paste code hoàn chỉnh này:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> boto3
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime, timedelta
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Initialize AWS clients</span>
</span></span><span style="display:flex;"><span>ses <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;ses&#39;</span>)
</span></span><span style="display:flex;"><span>dynamodb <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>resource(<span style="color:#e6db74">&#39;dynamodb&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">lambda_handler</span>(event, context):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Send email notifications for processed documents
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Get document processing results from DynamoDB</span>
</span></span><span style="display:flex;"><span>        table <span style="color:#f92672">=</span> dynamodb<span style="color:#f92672">.</span>Table(<span style="color:#e6db74">&#39;rpa-processed-data&#39;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Get documents from the last 24 hours</span>
</span></span><span style="display:flex;"><span>        cutoff_time <span style="color:#f92672">=</span> (datetime<span style="color:#f92672">.</span>utcnow() <span style="color:#f92672">-</span> timedelta(hours<span style="color:#f92672">=</span><span style="color:#ae81ff">24</span>))<span style="color:#f92672">.</span>isoformat()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        response <span style="color:#f92672">=</span> table<span style="color:#f92672">.</span>scan(
</span></span><span style="display:flex;"><span>            FilterExpression<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;processed_at &gt; :cutoff_time&#39;</span>,
</span></span><span style="display:flex;"><span>            ExpressionAttributeValues<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;:cutoff_time&#39;</span>: cutoff_time}
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        recent_documents <span style="color:#f92672">=</span> response[<span style="color:#e6db74">&#39;Items&#39;</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># If no recent documents, send a status email</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> recent_documents:
</span></span><span style="display:flex;"><span>            recent_documents <span style="color:#f92672">=</span> get_latest_documents(table, <span style="color:#ae81ff">5</span>)  <span style="color:#75715e"># Get last 5 documents</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Generate email content</span>
</span></span><span style="display:flex;"><span>        email_content <span style="color:#f92672">=</span> generate_email_content(recent_documents)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Get recipient email from environment or use default</span>
</span></span><span style="display:flex;"><span>        recipient_email <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;YOUR_EMAIL@example.com&#34;</span>  <span style="color:#75715e"># Thay bằng email đã xác minh</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Send email using SES</span>
</span></span><span style="display:flex;"><span>        send_email(
</span></span><span style="display:flex;"><span>            subject<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;🤖 Báo cáo Xử lý RPA - &#34;</span> <span style="color:#f92672">+</span> datetime<span style="color:#f92672">.</span>utcnow()<span style="color:#f92672">.</span>strftime(<span style="color:#e6db74">&#39;%Y-%m-</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">&#39;</span>),
</span></span><span style="display:flex;"><span>            body<span style="color:#f92672">=</span>email_content,
</span></span><span style="display:flex;"><span>            recipient<span style="color:#f92672">=</span>recipient_email
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;statusCode&#39;</span>: <span style="color:#ae81ff">200</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;body&#39;</span>: json<span style="color:#f92672">.</span>dumps({
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;message&#39;</span>: <span style="color:#e6db74">&#39;Email sent successfully&#39;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;documents_processed&#39;</span>: len(recent_documents),
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;recipient&#39;</span>: recipient_email
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Error sending email: </span><span style="color:#e6db74">{</span>str(e)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;statusCode&#39;</span>: <span style="color:#ae81ff">500</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;body&#39;</span>: json<span style="color:#f92672">.</span>dumps({
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;error&#39;</span>: str(e),
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;message&#39;</span>: <span style="color:#e6db74">&#39;Failed to send email&#39;</span>
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_latest_documents</span>(table, limit<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Lấy tài liệu gần nhất nếu không tìm thấy tài liệu recent
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        response <span style="color:#f92672">=</span> table<span style="color:#f92672">.</span>scan()
</span></span><span style="display:flex;"><span>        items <span style="color:#f92672">=</span> response[<span style="color:#e6db74">&#39;Items&#39;</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Sắp xếp theo processed_at timestamp (mới nhất trước)</span>
</span></span><span style="display:flex;"><span>        sorted_items <span style="color:#f92672">=</span> sorted(items, key<span style="color:#f92672">=</span><span style="color:#66d9ef">lambda</span> x: x<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;processed_at&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>), reverse<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> sorted_items[:limit]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Lỗi lấy tài liệu mới nhất: </span><span style="color:#e6db74">{</span>str(e)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">generate_email_content</span>(documents):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Tạo nội dung HTML email từ tài liệu đã xử lý
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    html_content <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &lt;!DOCTYPE html&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &lt;html&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &lt;head&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;meta charset=&#34;UTF-8&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;style&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            body </span><span style="color:#ae81ff">{{</span><span style="color:#e6db74"> 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                font-family: &#39;Segoe UI&#39;, Tahoma, Geneva, Verdana, sans-serif; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                line-height: 1.6; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                color: #333; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                max-width: 800px; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                margin: 0 auto; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                padding: 20px;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            </span><span style="color:#ae81ff">}}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            .header </span><span style="color:#ae81ff">{{</span><span style="color:#e6db74"> 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                color: white; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                padding: 30px; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                border-radius: 10px;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                text-align: center;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                margin-bottom: 30px;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            </span><span style="color:#ae81ff">}}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            .header h1 </span><span style="color:#ae81ff">{{</span><span style="color:#e6db74"> margin: 0; font-size: 28px; </span><span style="color:#ae81ff">}}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            .header p </span><span style="color:#ae81ff">{{</span><span style="color:#e6db74"> margin: 10px 0 0 0; opacity: 0.9; </span><span style="color:#ae81ff">}}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            .summary </span><span style="color:#ae81ff">{{</span><span style="color:#e6db74"> 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                background: #f8f9fa; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                padding: 20px; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                border-radius: 8px; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                margin-bottom: 30px;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                border-left: 4px solid #667eea;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            </span><span style="color:#ae81ff">}}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            .document </span><span style="color:#ae81ff">{{</span><span style="color:#e6db74"> 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                background: white;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                border: 1px solid #e9ecef; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                margin: 15px 0; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                padding: 20px; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                border-radius: 8px;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            </span><span style="color:#ae81ff">}}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            .document h3 </span><span style="color:#ae81ff">{{</span><span style="color:#e6db74"> 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                color: #495057; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                margin-top: 0; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                border-bottom: 2px solid #e9ecef;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                padding-bottom: 10px;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            </span><span style="color:#ae81ff">}}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            .key-value </span><span style="color:#ae81ff">{{</span><span style="color:#e6db74"> 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                margin: 8px 0; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                padding: 5px 0;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            </span><span style="color:#ae81ff">}}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            .key </span><span style="color:#ae81ff">{{</span><span style="color:#e6db74"> 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                font-weight: 600; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                color: #495057; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                display: inline-block;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                min-width: 120px;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            </span><span style="color:#ae81ff">}}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            .value </span><span style="color:#ae81ff">{{</span><span style="color:#e6db74"> 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                color: #6c757d; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                background: #f8f9fa;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                padding: 2px 8px;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                border-radius: 4px;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            </span><span style="color:#ae81ff">}}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            .confidence </span><span style="color:#ae81ff">{{</span><span style="color:#e6db74"> 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                background: #d4edda; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                color: #155724; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                padding: 4px 8px; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                border-radius: 4px; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                font-size: 12px;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                font-weight: bold;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            </span><span style="color:#ae81ff">}}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            .footer </span><span style="color:#ae81ff">{{</span><span style="color:#e6db74"> 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                margin-top: 40px; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                padding: 20px; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                background: #e9ecef; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                border-radius: 8px; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                text-align: center;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                color: #6c757d;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            </span><span style="color:#ae81ff">}}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            .stats </span><span style="color:#ae81ff">{{</span><span style="color:#e6db74"> 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                display: flex; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                justify-content: space-around; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                margin: 20px 0;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            </span><span style="color:#ae81ff">}}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            .stat </span><span style="color:#ae81ff">{{</span><span style="color:#e6db74"> 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                text-align: center; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                padding: 15px;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            </span><span style="color:#ae81ff">}}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            .stat-number </span><span style="color:#ae81ff">{{</span><span style="color:#e6db74"> 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                font-size: 24px; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                font-weight: bold; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                color: #667eea;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            </span><span style="color:#ae81ff">}}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            .stat-label </span><span style="color:#ae81ff">{{</span><span style="color:#e6db74"> 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                font-size: 12px; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                color: #6c757d; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                text-transform: uppercase;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            </span><span style="color:#ae81ff">}}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;/style&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &lt;/head&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &lt;body&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;div class=&#34;header&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;h1&gt;🤖 Báo cáo Xử lý RPA&lt;/h1&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;p&gt;Tạo lúc: </span><span style="color:#e6db74">{</span>datetime<span style="color:#f92672">.</span>utcnow()<span style="color:#f92672">.</span>strftime(<span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">/%m/%Y lúc %H:%M UTC&#39;</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/p&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;div class=&#34;summary&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;div class=&#34;stats&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &lt;div class=&#34;stat&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &lt;div class=&#34;stat-number&#34;&gt;</span><span style="color:#e6db74">{</span>len(documents)<span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &lt;div class=&#34;stat-label&#34;&gt;Tài liệu đã xử lý&lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &lt;div class=&#34;stat&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &lt;div class=&#34;stat-number&#34;&gt;</span><span style="color:#e6db74">{</span>calculate_avg_confidence(documents)<span style="color:#e6db74">:</span><span style="color:#e6db74">.1f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">%&lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &lt;div class=&#34;stat-label&#34;&gt;Độ tin cậy TB&lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &lt;div class=&#34;stat&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &lt;div class=&#34;stat-number&#34;&gt;</span><span style="color:#e6db74">{</span>count_total_extractions(documents)<span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &lt;div class=&#34;stat-label&#34;&gt;Dữ liệu trích xuất&lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> documents:
</span></span><span style="display:flex;"><span>        html_content <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;div class=&#34;document&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;h3&gt;📭 Không có Tài liệu Gần đây&lt;/h3&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;p&gt;Không có tài liệu nào được xử lý trong 24 giờ qua. Hệ thống RPA của bạn đã sẵn sàng và đang chờ tài liệu mới!&lt;/p&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i, doc <span style="color:#f92672">in</span> enumerate(documents[:<span style="color:#ae81ff">10</span>]):  <span style="color:#75715e"># Hiển thị tối đa 10 tài liệu</span>
</span></span><span style="display:flex;"><span>            file_name <span style="color:#f92672">=</span> doc<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;file_name&#39;</span>, <span style="color:#e6db74">&#39;File không xác định&#39;</span>)
</span></span><span style="display:flex;"><span>            processed_at <span style="color:#f92672">=</span> doc<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;processed_at&#39;</span>, <span style="color:#e6db74">&#39;Không xác định&#39;</span>)
</span></span><span style="display:flex;"><span>            confidence <span style="color:#f92672">=</span> doc<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;confidence_score&#39;</span>, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Format timestamp</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>                dt <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>fromisoformat(processed_at<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;Z&#39;</span>, <span style="color:#e6db74">&#39;+00:00&#39;</span>))
</span></span><span style="display:flex;"><span>                formatted_time <span style="color:#f92672">=</span> dt<span style="color:#f92672">.</span>strftime(<span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">/%m/%Y lúc %H:%M UTC&#39;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>                formatted_time <span style="color:#f92672">=</span> processed_at
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            html_content <span style="color:#f92672">+=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;div class=&#34;document&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &lt;h3&gt;📄 </span><span style="color:#e6db74">{</span>file_name<span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/h3&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &lt;div class=&#34;key-value&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &lt;span class=&#34;key&#34;&gt;Xử lý lúc:&lt;/span&gt; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &lt;span class=&#34;value&#34;&gt;</span><span style="color:#e6db74">{</span>formatted_time<span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/span&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &lt;div class=&#34;key-value&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &lt;span class=&#34;key&#34;&gt;Độ tin cậy:&lt;/span&gt; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &lt;span class=&#34;confidence&#34;&gt;</span><span style="color:#e6db74">{</span>confidence<span style="color:#e6db74">}</span><span style="color:#e6db74">%&lt;/span&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Thêm key-value pairs đã trích xuất</span>
</span></span><span style="display:flex;"><span>            key_values <span style="color:#f92672">=</span> doc<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;key_value_pairs&#39;</span>, {})
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> key_values <span style="color:#f92672">and</span> isinstance(key_values, dict):
</span></span><span style="display:flex;"><span>                html_content <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;&lt;h4&gt;📊 Dữ liệu trích xuất:&lt;/h4&gt;&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> key, value <span style="color:#f92672">in</span> list(key_values<span style="color:#f92672">.</span>items())[:<span style="color:#ae81ff">5</span>]:  <span style="color:#75715e"># Hiển thị 5 cặp key-value đầu</span>
</span></span><span style="display:flex;"><span>                    html_content <span style="color:#f92672">+=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &lt;div class=&#34;key-value&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        &lt;span class=&#34;key&#34;&gt;</span><span style="color:#e6db74">{</span>key<span style="color:#e6db74">}</span><span style="color:#e6db74">:&lt;/span&gt; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        &lt;span class=&#34;value&#34;&gt;</span><span style="color:#e6db74">{</span>value<span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/span&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            html_content <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;&lt;/div&gt;&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    html_content <span style="color:#f92672">+=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;div class=&#34;footer&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;p&gt;&lt;strong&gt;✅ Trạng thái Hệ thống RPA: Hoạt động&lt;/strong&gt;&lt;/p&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;p&gt;Hệ thống xử lý tài liệu tự động của bạn đang chạy mượt mà.&lt;/p&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &lt;p&gt;&lt;em&gt;Đây là thông báo tự động từ nền tảng RPA trên AWS.&lt;/em&gt;&lt;/p&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt;/div&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &lt;/body&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &lt;/html&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> html_content
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">calculate_avg_confidence</span>(documents):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Tính điểm confidence trung bình&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> documents:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    confidences <span style="color:#f92672">=</span> [doc<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;confidence_score&#39;</span>, <span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">for</span> doc <span style="color:#f92672">in</span> documents]
</span></span><span style="display:flex;"><span>    valid_confidences <span style="color:#f92672">=</span> [c <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> confidences <span style="color:#66d9ef">if</span> c <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> sum(valid_confidences) <span style="color:#f92672">/</span> len(valid_confidences) <span style="color:#66d9ef">if</span> valid_confidences <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">count_total_extractions</span>(documents):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Đếm tổng số data points đã trích xuất&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    total <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> doc <span style="color:#f92672">in</span> documents:
</span></span><span style="display:flex;"><span>        key_values <span style="color:#f92672">=</span> doc<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;key_value_pairs&#39;</span>, {})
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> isinstance(key_values, dict):
</span></span><span style="display:flex;"><span>            total <span style="color:#f92672">+=</span> len(key_values)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> total
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">send_email</span>(subject, body, recipient):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Gửi email bằng Amazon SES
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        response <span style="color:#f92672">=</span> ses<span style="color:#f92672">.</span>send_email(
</span></span><span style="display:flex;"><span>            Source<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;YOUR_EMAIL@example.com&#39;</span>,  <span style="color:#75715e"># Thay bằng email đã xác minh</span>
</span></span><span style="display:flex;"><span>            Destination<span style="color:#f92672">=</span>{
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;ToAddresses&#39;</span>: [recipient]
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            Message<span style="color:#f92672">=</span>{
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;Subject&#39;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#39;Data&#39;</span>: subject,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#39;Charset&#39;</span>: <span style="color:#e6db74">&#39;UTF-8&#39;</span>
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;Body&#39;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#39;Html&#39;</span>: {
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#39;Data&#39;</span>: body,
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#39;Charset&#39;</span>: <span style="color:#e6db74">&#39;UTF-8&#39;</span>
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Email sent successfully. Message ID: </span><span style="color:#e6db74">{</span>response[<span style="color:#e6db74">&#39;MessageId&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> response
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Error sending email: </span><span style="color:#e6db74">{</span>str(e)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span> e
</span></span></code></pre></div><h4 id="bước-4-cập-nhật-email-addresses">Bước 4: Cập nhật Email Addresses</h4>
<p><strong>QUAN TRỌNG</strong>: Bạn phải cập nhật địa chỉ email trong code:</p>
<ol>
<li>Tìm dòng này: <code>recipient_email = &quot;YOUR_EMAIL@example.com&quot;</code></li>
<li>Thay bằng email đã xác minh từ Bước 1.3</li>
<li>Tìm dòng này: <code>Source='YOUR_EMAIL@example.com'</code></li>
<li>Thay bằng cùng email đã xác minh</li>
<li>Cả hai phải là cùng địa chỉ email bạn đã xác minh trong SES</li>
</ol>
<h4 id="bước-5-deploy-code">Bước 5: Deploy Code</h4>
<ol>
<li>Sau khi cập nhật email addresses, click <strong>Deploy</strong></li>
<li>Đợi thông báo &ldquo;Changes deployed&rdquo;</li>
<li>Code đã được lưu và sẵn sàng chạy
<img src="/images/3/Add-Email-Automation-Code-3.png" alt="Add-Email-Automation-Code-3"></li>
</ol>
<h4 id="bước-6-test-function">Bước 6: Test Function</h4>
<ol>
<li>Click nút <strong>Test</strong></li>
<li>Chọn <strong>Create new test event</strong></li>
<li>Event name: <code>test-email</code></li>
<li>Giữ JSON mặc định (function không sử dụng event data)</li>
<li>Click <strong>Test</strong></li>
<li>Kiểm tra email của bạn để xem báo cáo tóm tắt RPA</li>
</ol>
<h4 id="hiểu-về-email-code">Hiểu về Email Code</h4>
<p><strong>Tính năng Chính:</strong></p>
<ul>
<li>Query DynamoDB cho tài liệu gần đây</li>
<li>Tạo email HTML chuyên nghiệp</li>
<li>Bao gồm thống kê và tóm tắt</li>
<li>Xử lý trường hợp không có tài liệu gần đây</li>
<li>Thiết kế email responsive</li>
</ul>
<p><strong>Nội dung Email:</strong></p>
<ul>
<li>Thống kê xử lý</li>
<li>Chi tiết tài liệu riêng lẻ</li>
<li>Preview dữ liệu đã trích xuất</li>
<li>Điểm confidence</li>
<li>Styling chuyên nghiệp</li>
</ul>
<h4 id="khắc-phục-sự-cố">Khắc phục Sự cố</h4>
<p><strong>Nếu email không đến:</strong></p>
<ul>
<li>Kiểm tra thư mục spam/junk</li>
<li>Xác minh địa chỉ email đúng</li>
<li>Kiểm tra giới hạn gửi SES</li>
<li>Xem CloudWatch logs để tìm lỗi</li>
</ul>
<p><strong>Nếu function thất bại:</strong></p>
<ul>
<li>Kiểm tra email addresses đã xác minh trong SES</li>
<li>Xác minh quyền DynamoDB table</li>
<li>Kiểm tra lỗi syntax trong code</li>
</ul>
<h4 id="bước-tiếp-theo-là-gì">Bước tiếp theo là gì?</h4>
<p>Email automation code của bạn đã sẵn sàng! Tiếp theo, chúng ta sẽ thiết lập scheduling tự động để bạn nhận báo cáo hàng ngày mà không cần can thiệp thủ công.</p>

<div class="notices tip" ><p>Email bao gồm responsive design và hoạt động tốt trên cả desktop và mobile devices!</p>
</div>






<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/vi/3-email-bot/3.1-create-email-lambda/" title="Tạo Email Lambda Function"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/vi/3-email-bot/3.3-configure-schedule/" title="Cấu hình Lịch Email" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1754284887"></script>
    <script src="/js/perfect-scrollbar.min.js?1754284887"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1754284887"></script>
    <script src="/js/jquery.sticky.js?1754284887"></script>
    <script src="/js/featherlight.min.js?1754284887"></script>
    <script src="/js/highlight.pack.js?1754284887"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1754284887"></script>
    <script src="/js/learn.js?1754284887"></script>
    <script src="/js/hugo-learn.js?1754284887"></script>

    <link href="/mermaid/mermaid.css?1754284887" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1754284887"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>

  </body>
</html>

